<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>100å‡é­”æ”¹é€ ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– - ä¼šå“¡å°‚ç”¨</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; }
        h1 { color: #00ff88; text-align: center; border-bottom: 2px solid #00ff88; }
        .auth-box, .post-form { background: #1e1e1e; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #333; }
        input, textarea { width: 100%; margin: 8px 0; padding: 12px; background: #2a2a2a; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; }
        button { padding: 10px 15px; background: #00ff88; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; margin-right: 5px; }
        .btn-delete { background: #ff4444; color: white; margin-top: 10px; font-size: 0.8rem; }
        .card { background: #1e1e1e; padding: 15px; margin-top: 15px; border-radius: 8px; border-left: 5px solid #00ff88; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ›  100å‡é­”æ”¹é€ ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h1>

    <div id="auth-section" class="auth-box">
        <h3>ãƒ­ã‚°ã‚¤ãƒ³ / ä¼šå“¡ç™»éŒ²</h3>
        <p style="font-size: 0.8rem;">â€»æ–°è¦ç™»éŒ²å¾Œã¯ãƒ¡ãƒ¼ãƒ«ã®URLã‚’å¿…ãšã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p>
        <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
        <button onclick="signUp()">æ–°è¦ç™»éŒ²</button>
        <button onclick="signIn()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <div id="post-section" class="post-form hidden">
        <div id="user-info" style="font-size: 0.8rem; color: #aaa; margin-bottom: 10px;"></div>
        <input type="text" id="t" placeholder="æ”¹é€ ã®ã‚¿ã‚¤ãƒˆãƒ«">
        <textarea id="c" rows="3" placeholder="æ”¹é€ ã®å†…å®¹ã‚„ä½¿ã£ãŸææ–™"></textarea>
        <button onclick="send()">ä¸–ç•Œã«å…¬é–‹ã™ã‚‹</button>
        <button onclick="signOut()" style="background:#555;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>

    <div id="list">èª­ã¿è¾¼ã¿ä¸­...</div>
</div>

<script>
    // --- ã€ã‚¨ãƒ©ãƒ¼å¯¾ç­–æ¸ˆã¿ã€‘URLã¨KEYã®è¨­å®š ---
    // æ–‡å­—åˆ—ã‚’åˆ†è§£ã—ã¦çµåˆã™ã‚‹ã“ã¨ã§ã€ç›®ã«è¦‹ãˆãªã„è¨˜å·ãŒå…¥ã‚‹ã®ã‚’é˜²ãã¾ã™
    const protocol = "https://";
    const projectID = "xkcoybhgybehcplrnjpy";
    const domain = ".supabase.co";
    const FINAL_URL = (protocol + projectID + domain).trim();
    
    const FINAL_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrY295YmhneWJlaGNwbHJuanB5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MTk5MzEsImV4cCI6MjA4NDM5NTkzMX0.KAukWRsZcdjiC8rEITmPRRdJ6nj-s7pMDdpcBOBPNek'.trim();

    // æ¥ç¶šï¼ˆMalformedã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ä¸€ç•ªå®‰å…¨ãªæ–¹æ³•ï¼‰
    const client = supabase.createClient(FINAL_URL, FINAL_KEY);

    let currentUser = null;

    // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç›£è¦–
    client.auth.onAuthStateChange((event, session) => {
        currentUser = session?.user || null;
        if (currentUser) {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('post-section').classList.remove('hidden');
            document.getElementById('user-info').innerText = `ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ${currentUser.email}`;
        } else {
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('post-section').classList.add('hidden');
        }
        load();
    });

    async function signUp() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        const { error } = await client.auth.signUp({ email: e, password: p });
        if (error) alert("ã‚¨ãƒ©ãƒ¼: " + error.message);
        else alert("ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚Šã¾ã—ãŸï¼ãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚");
    }

    async function signIn() {
        const e = document.getElementById('email').value;
        const p = document.getElementById('password').value;
        const { error } = await client.auth.signInWithPassword({ email: e, password: p });
        if (error) alert("å¤±æ•—: " + error.message);
    }

    async function signOut() {
        await client.auth.signOut();
        alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ");
    }

    async function send() {
        const t = document.getElementById('t');
        const c = document.getElementById('c');
        if(!t.value || !c.value) return alert("å…¥åŠ›ã—ã¦ã­");
        const { error } = await client.from('posts').insert([{ title: t.value, content: c.value, user_id: currentUser.id }]);
        if (error) alert("æŠ•ç¨¿å¤±æ•—: " + error.message);
        else { t.value = ''; c.value = ''; load(); }
    }

    async function load() {
        const { data, error } = await client.from('posts').select('*').order('created_at', { ascending: false });
        if (error) return;
        let h = '';
        data.forEach(p => {
            const isMyPost = currentUser && p.user_id === currentUser.id;
            h += `<div class="card"><h3>${p.title}</h3><p>${p.content}</p>${isMyPost ? `<button class="btn-delete" onclick="deletePost('${p.id}')">å‰Šé™¤ã™ã‚‹</button>` : ''}</div>`;
        });
        document.getElementById('list').innerHTML = h || "æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
    }

    async function deletePost(id) {
        if (!confirm("æ¶ˆã—ã¾ã™ã‹ï¼Ÿ")) return;
        const { error } = await client.from('posts').delete().eq('id', id);
        if (error) alert("å¤±æ•—: " + error.message);
        else load();
    }

    load();
</script>
</body>
</html>